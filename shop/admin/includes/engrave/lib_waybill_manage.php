<?php/** * ENGRAVE 数据访问：包裹管理-包裹管理 * =========================================================== * * 版权所有 2014-2019 青岛友腾信息科技有限公司，并保留所有权利。 * 网站地址: http://www.qdutsoft.com； * ---------------------------------------------------------- * 这不是一个自由软件！您只能在不用于商业目的的前提下对程序代码进行修改和 * 使用；不允许对程序代码以任何形式任何目的的再发布。 * ========================================================== * $Author: cfang $ * $Id: lib_waybill_manage.php 17217 2014年12月07日 11时03分00秒 zhangxingpeng $ */function engrave_waybill_order_list($real_goods=1, $conditions = ''){	/* 记录总数 */	$sql_count = "SELECT COUNT(*) FROM " .$GLOBALS['engrave']->table('orderwaybill').	" WHERE ordw_delete = 0";	$filter['record_count'] = $GLOBALS['engrave_db']->getOne($sql_count);	/* 分页大小 */	$filter = page_and_size($filter);		$sql = "SELECT *,area_country.Name as CountyName,area_province.Name as ProvinceName,area_city.Name as CityName " .			" FROM " . $GLOBALS['engrave']->table('orderwaybill') .			" LEFT JOIN " . $GLOBALS['ecs']->table('users_deliveryaddress') .			" ON ordw_consigid = da_id ".			" LEFT JOIN " . $GLOBALS['engrave']->table('area') . " as area_country " .			" ON da_country = area_country.Id ".			" LEFT JOIN " . $GLOBALS['engrave']->table('area') . " as area_province " .			" ON da_province = area_province.Id ".			" LEFT JOIN " . $GLOBALS['engrave']->table('area') . " as area_city " .			" ON da_city = area_city.Id ".			" LEFT JOIN " . $GLOBALS['engrave']->table('order') .			" ON ordw_orderid = order_id ".			" LEFT JOIN " . $GLOBALS['engrave']->table('shipping') .			" ON order_shippingid = ShippingId ".			" LEFT JOIN " . $GLOBALS['engrave']->table('warehouse') .			" ON Origin = AreaId ".			" LEFT JOIN " . $GLOBALS['engrave']->table('currecy') .			" ON engrave_warehouse.CurrencyId = CId ".			" LEFT JOIN " . $GLOBALS['engrave']->table('collogistics') .			" ON ordw_collogisid = LogisticsId ".			" LEFT JOIN " . $GLOBALS['ecs']->table('users') .			" ON order_userid = user_id ".			" WHERE ordw_delete = 0 ".	        " LIMIT " . $filter['start'] . ",$filter[page_size]";				$filter['keyword'] = stripslashes($filter['keyword']);			$row = $GLOBALS['engrave_db']->getAll($sql);			foreach ($row AS $key=>$val)			{				$row[$key]['order_time']     = local_date($GLOBALS['_CFG']['time_format'], $val['order_time']);			}						return array('waybill_list' => $row, 'filter' => $filter, 'page_count' => $filter['page_count'], 'record_count' => $filter['record_count']);}/** * 获得状态代码列表 * * @return multitype:string */function engrave_waybillcode_list(){	$sql = 'SELECT code_id, code_name FROM ' . $GLOBALS['engrave']->table('statucode') .	' WHERE code_isdelete = 0 ORDER BY code_id';	$res = $GLOBALS['engrave_db']->getAll($sql);	$code_list = array();	foreach ($res AS $row)	{		$code_list[$row['code_id']] = addslashes($row['code_name']);	}	return $code_list;}/** * 添加跟踪管理 * @param unknown $coupon：跟踪管理对象 */function engrave_waybill_tracking_insert($track_info){	$sql = "insert into ".$GLOBALS['engrave']->table('package_track').	"(tr_orderid,tr_expressnumber,tr_message,tr_statuscode,tr_intime,tr_operatorid,tr_isdelete) values('".	$track_info['tr_orderid']."','".$track_info['tr_expressnumber']."','".$track_info['tr_message']."','".	$track_info['tr_statuscode']."','".$track_info['tr_intime']."','".	$track_info['tr_operatorid']."','".$track_info['tr_isdelete']."')";	return $GLOBALS['engrave_db']->query($sql);}/** * 删除跟踪管理 * @param number $ordw_delete * @param unknown $ordw_waybillid */function engrave_waybill_tracking_delete($ordw_delete=1,$ordw_waybillid){	$sql = "update ".$GLOBALS['engrave']->table('orderwaybill').	" set ordw_delete = '".$ordw_delete."' where ordw_waybillid = '".	$ordw_waybillid."'";	return  $GLOBALS['engrave_db']->query($sql);}?>