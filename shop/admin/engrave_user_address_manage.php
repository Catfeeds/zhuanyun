<?php /** * ENGRAVE 收货人地址维护 * =========================================================== * 版权所有 2014-2019 青岛友腾信息科技有限公司，并保留所有权利。 * 网站地址: http://www.qdutsoft.com； * ---------------------------------------------------------- * 这不是一个自由软件！您只能在不用于商业目的的前提下对程序代码进行修改和 * 使用；不允许对程序代码以任何形式任何目的的再发布。 * ========================================================== * $Author: zhangxingpeng $ * $Id: engrave_user_address_manage.php 17217 2014年11月28日 11时03分00秒 zhangxingpeng $ */define('IN_ECS', true);require(dirname(__FILE__) . '/includes/init.php');/* 载入语言文件 */require_once(ROOT_PATH . 'languages/' .$_CFG['lang']. '/admin/engrave_user_address_manage.php');/*载入-用户组管理-数据访问文件*/require_once(ROOT_PATH . 'admin/includes/engrave/lib_user_address_manage.php');require_once(ROOT_PATH . 'admin/includes/engrave/lib_country.php');/** * 页面：列表 */if($_REQUEST['act'] == 'list'){    /* 检查权限 */    admin_priv('address_manage');    $smarty->assign('full_page', 1);        $ur_here = $_LANG['06_member_manage'] .'｜'.$_LANG['08_user_address_manage'];    $smarty->assign('ur_here', $ur_here);    $area_countries = engrave_countries();    $address_list= engrave_user_address_list();    foreach ($address_list[address_list] AS $key=>$val)    {        $address_list[address_list][$key]['country_name'] = $area_countries[$val['da_country']];    }    $smarty->assign('address_list',   $address_list['address_list']);    $smarty->assign('filter',       $address_list['filter']);    $smarty->assign('record_count', $address_list['record_count']);    $smarty->assign('page_count',   $address_list['page_count']);    	$smarty->display('engrave_user_address_list.htm');}/*------------------------------------------------------ *///-- 页面：列表/*------------------------------------------------------ */elseif ($_REQUEST['act'] == 'query'){    $address_list= engrave_user_address_list();    $smarty->assign('address_list',   $address_list['address_list']);    $smarty->assign('filter',       $address_list['filter']);    $smarty->assign('record_count', $address_list['record_count']);    $smarty->assign('page_count',   $address_list['page_count']);	    $sort_flag  = sort_flag($address_list['filter']);    $smarty->assign($sort_flag['tag'], $sort_flag['img']);    	make_json_result($smarty->fetch('engrave_user_address_list.htm'), '',			array('filter' => $address_list['filter'], 'page_count' => $address_list['page_count']));	}/** * 页面：编辑 */elseif($_REQUEST['act'] == 'edit'){	/* 检查权限 */	admin_priv('address_manage');    $area_countries = engrave_countries();	$da_id=isset($_REQUEST['da_id'])?intval($_REQUEST['da_id']):'0';	//获取 收货人	$address = engrave_user_address_byid($da_id);	$smarty->assign('address', $address);		$smarty->assign('action_link',  array('text' => $_LANG['08_user_address_manage'], 'href'=>'engrave_user_address_manage.php?act=list'));	$ur_here = $_LANG['03_content_manage'] .'｜'.$_LANG['edit_address'];	$smarty->assign('ur_here', $ur_here);	$smarty->assign('area_countries', $area_countries);	$smarty->assign('form_act','update');	$smarty->assign('full_page',    1);		/* 显示商品列表页面 */	assign_query_info();	$smarty->display('engrave_user_address_info.htm');}/** * 数据库：修改 */elseif($_REQUEST['act'] == 'update'){	//收货人地址：id、验证状态、管理员备注	$address['da_id'] = isset($_POST['da_id']) ? intval($_POST['da_id']) : 0;	$address['da_isvalidate'] = isset($_POST['da_validate']) ? intval($_POST['da_validate']) : 0;	$address['da_adminremark'] = isset($_POST['da_adminremark']) ? trim($_POST['da_adminremark']) : '';	$link[0]['text'] = $_LANG['back_user_address_list'];	$link[0]['href'] = 'engrave_user_address_manage.php?act=list';		if(engrave_user_address_update_validate($address))	{		sys_msg($_LANG['operte_success'], 0, $link);	}	else{		sys_msg($_LANG['operte_failed'], 0, $link);	}}?>