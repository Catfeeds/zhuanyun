 {include file="header_user.htm"}{literal}<style type="text/css">table {font-size:14px}    div.order_tit { font-size:15px; font-weight:bold; color:#333; line-height:35px; 	padding-left:10px; height:33px; background-color : rgba(200, 195, 195, 0.16);}    div.delivery_box { line-height: 150%; }    div.delivery_item {  }    ul.item_list { font-weight: bold; list-style: none; }    ul.og_list { line-height: 150%; list-style: none; }    ul.og_list li.item { font-weight: bold; }    table.orderTb { border-collapse: collapse; width: 100%; margin: 10px auto; }    table.orderTb tr th, table.orderTb tr td { padding: 5px; }    table.orderTb tr th { text-align: right; width: 9%; }    table.orderTb tr td { text-align: left; }    .mt10 {margin-top:10px;}	.pd10 {padding:10px;}	.blank10 {height: 10px;overflow: hidden;clear: both;}	div.border {border: solid 1px #333;margin: 10px;}	div.cnt {background: #ddd;margin: 5px;padding: 5px;}			div.border h2 {margin: 0px;padding: 0px;line-height: 32px;height: 32px;text-indent: 15px;font-size: 15px;background: #555;color: #fff;}table.orderTbs{	margin-bottom:5px;}    table.orderTbs tr th {text-align: center;	background:rgba(200, 195, 195, 0.16);color: #000;padding: 8px;	border:1px solid #DDDDDD;}    table.orderTbs {width: 100%;border: none;border-collapse: collapse;table-layout: fixed;}    table.orderTbs tr td {text-align: center;padding:6px 0px;color: #000;border:1px solid #DDDDDD;}        table.orderTbs tr td_left {text-align: center;padding:6px 0px;color: #000;border:1px solid #DDDDDD;}	.fee-list>div{		padding: 5px;		padding-left: 50px;		font-size: 16px	}</style>{/literal}   <!--conter-->    <div class="conter">    	<div class="blank10"></div>            <div class="order_tit">订单信息</div>            <table  class="orderTbs" cellspacing="0" style="border-collapse:collapse;">                <tr id="orderNoTR">	                <th style="width:100px;">订单号</th>                    <th >货物详情</th>                    <th style="width:150px;">发货渠道</th>                    <th style="width:150px;">提交日期</th>                    <th style="width:100px;">当前状态</th>                </tr>                <tr class="orderTbs_tr">	                <td>{$order_list.order_no}</td>                    <td id="package_goods"></td>                    <td>{$order_list.shipment.shipment_name}					{if $order_list.order_shipmentid==2}						时效要求: {if $order_list.order_time_request == 'normal' }正常{else}紧急{/if}						{/if}					</td>                    <td>{$order_list.order_time}</td>                                        <td>                        <strong>                        {if $order_list.order_iscolsed eq 0}                          {if $order_list.order_isdelivery eq 0}未配货						  {elseif $order_list.order_isdelivery eq 1}已配货						  {elseif $order_list.order_isdelivery eq 2}处理中						  {elseif $order_list.order_isdelivery eq 3}待付款						  {elseif $order_list.order_isdelivery eq 4}待发货						  {elseif $order_list.order_isdelivery eq 5}已发货						  {elseif $order_list.order_isdelivery eq 6}已完成						  {/if}						{else}已关闭						{/if}						</strong>                    </td>                </tr>            </table>            <div class="order_tit">运单信息</div>            <table class="orderTbs" cellspacing="0" style="border-collapse:collapse;">                <tr>                    <!-- <th>分箱件数</th> -->                    <th style="width:100px;">运单号</th>                    <th style="width:60px;">申报价值</th>                    <th style="width:60px;">包裹重量</th>                    <th style="width:100px;">发货单号</th>                    <th style="width:60px;">货物详情</th>                    <th style="width:2s00px;">收货信息</th>                    <th style="width:60px;">包裹运费</th>                    <th style="width:60px;">关税</th>                    <th style="width:60px;">保险费用</th>                </tr>                <tbody id="delivery">                <!--<tr id="delivery">                     <td>                        <strong class="red">{$order_list.order_boxquantity}</strong>                    </td>                    <td colspan=9>                       <div class="delivery_box" id="delivery">						</div>                    </td>                                    </tr> -->                </tbody>            </table>			<h2>费用详情</h2>			<div class="fee-list">				<div>					<span><strong>仓储费用:</strong></span>					<span>{$order_list.order_warehousecost}{$order_list.Name}</span>				</div>				<div>					<span><strong>关税:</strong></span>					<span>{$order_list.order_tariffcost}</span>				</div>				<div>					<span><strong>增值服务费:</strong></span>					<span>{$order_list.order_valueservicecost}</span>				</div>				<div>					<span><strong>合箱/分箱:</strong></span>					<span>{$order_list.order_boxquantity}</span>				</div>				<div>					<span><strong>其它操作费:</strong></span>					<span>{$order_list.order_othercost}</span>				</div>				<div>					<span><strong>运费折扣:</strong></span>					<span>{$order_list.order_shipment_discount*100}%</span>				</div>				<div>					<span><strong>基本运费:</strong></span>					<span>{$order_list.order_shipment_basicPrice}</span>				</div>				<div>					<span><strong>燃油附加费:</strong></span>					<span>{$order_list.order_shipment_oilDiscount}%</span>				</div>				<div style="text-align: right;">					<span><strong>总费用:</strong></span>					<span style="font-weight:bold; font-size:15px; color:#c90000">{$order_list.order_totalprice}</span>				</div>			</div>            <!--<table class="orderTbs" cellspacing="0" style="border-collapse:collapse;">-->             	<!--<tr>-->					<!--<th scope="col" style="width:100px;">仓储费用</th>-->					<!--<th scope="col" style="width:100px;">关税</th>-->					<!--<th scope="col" style="width:100px;">增值服务费</th>-->					<!--<th scope="col" >合箱/分箱</th>-->					<!--<th scope="col" style="width:100px;">其它操作费</th>-->					<!--<th scope="col" style="width:100px;">运费折扣</th>-->					<!--<th scope="col" style="width:100px;">总费用</th>-->				<!--</tr>-->				<!--<tr>-->					<!--<td>{$order_list.order_warehousecost}{$order_list.Name}</td>-->					<!--<td>{$order_list.order_tariffcost}{$order_list.Name}</td>-->					<!--<td>{$order_list.order_valueservicecost}{$order_list.Name}</td>-->					<!--<td>{$order_list.order_boxquantity}</td>-->					<!--<td>{$order_list.order_othercost}{$order_list.Name}</td>-->					<!--<td>{$order_list.order_shipment_discount}</td>-->					<!--<td>-->					<!--<span style="font-weight:bold; font-size:15px; color:#c90000">-->					<!--{$order_list.order_totalprice}</span>元-->					<!--</td>-->				<!--</tr>-->       		<!--</table>-->            <div class="order_tit">物品说明及附件</div>            <div class="pd10">            	{$order_list.order_note}            </div>            <div class="pd10">            	{foreach from=$order_attachs_list item=order_attach name="name_order_attach"}            		<a href="{$order_attach.oa_attach}" target="_black">            		<img style="width:40px; height:40px;" src="{$order_attach.oa_attach}"></img>            		</a>            	{/foreach}            </div>            <div class="order_tit">备注说明</div>            <div class="pd10">{$order_list.order_remark}</div>                       <div class="order_tit">订单历史操作状态</div>	  	    <table class="orderTbs" cellspacing="0" style="border-collapse:collapse;">		<tbody>		<tr>			<th scope="col" style="width:56px;">ID</th>			<th scope="col" style="width:80px;">操作用户</th>			<th scope="col" style="width:130px;">操作代码</th>			<th scope="col" >操作记录</th>			<th scope="col" style="width:130px;">操作时间</th>		</tr>		{foreach from=$orderlog_list item=orderlog name='name_orderlog'}		<tr>			<td>            	{$orderlog.ol_id}            </td>            <td>				{$orderlog.ol_username}			</td>            <td>				{$orderlog.ol_code}			</td>            <td class="tit">				{$orderlog.ol_info}			</td>            <td>				{$orderlog.ol_time}			</td>		</tr>		{/foreach}	    </tbody>	    </table>        </div>         <div class="blank10">            <input type="hidden"  name="orderid" id="orderid" value="{$order_list.order_id}" />        </div>	<script language="JavaScript">   {literal}	if(document.all)    { 		window.attachEvent('onload', load);	}	else 	{ 		window.addEventListener('load', load);	}		/**	 * 页面加载执行	 */	function load()	{		   var orderid = document.getElementById('orderid').value;	   Ajax.call('member_order.php?act=getpackageinformation',"order_id="+orderid,act_packageinfo,"GET","TEXT",false,true);	   Ajax.call('member_order.php?act=getpackageorderwaybill',"order_id="+orderid,act_orderwaybill,"GET","TEXT",false,true);	}	var text;	function act_packageinfo(result)	{	  text='';	  var obj = eval('(' + result + ')');	  var packagegood = document.getElementById("package_goods");	  for(var index = 0;index < obj.length;index++)	  {		  text += "<ul class='og_list'><li><lable for='og_73'>"+(index+1)+":快递单号: "+obj[index].pck_expressnumber+"&nbsp;"		        + "&nbsp;<span style='color:red;'>重量:"+obj[index].pck_weight				+"<span id='weightunit_"+(index+1)+"'>"+obj[index].WeightUnit+"</span></li>";		  Ajax.call( 'member_order.php?act=getpackagegoods', 'pck_id=' + obj[index].pck_id, packagegoods_callback , 'GET', 'TEXT', false, true );		  text+="</ul>";	  }	  packagegood.innerHTML = text;	}	function packagegoods_callback(result)	{	    var obj = eval('(' + result + ')');		for(var index = 0;index < obj.length;index++)		{			text += "<li class='item'>物品"+(index+1)+"&nbsp;:&nbsp;"+obj[index].pckg_name+"&nbsp;&nbsp;数量：&nbsp;"			        +obj[index].pckg_amount+"&nbsp;×&nbsp;单价：&nbsp;"+roundNumber(obj[index].pckg_unitprice,2)+"&nbsp;=&nbsp;总价：&nbsp;"+roundNumber(obj[index].pckg_totalprice,2)+"</li>";		}	}		    function act_orderwaybill(result)	{	   var waybillno = '';	   var order_text='';	   var obj = eval('(' + result + ')');	   var delivery = document.getElementById("delivery");	   for(var index = 0;index < obj.length;index++)	   {	   	  if(obj[index].ordw_waybillno == undefined)	      {	   	     waybillno = '未发货';	      }		  else		  {		  	waybillno = obj[index].ordw_waybillno;		  }	   	  Ajax.call( 'member_order.php?act=getordergoods', 'ordw_waybillid=' + obj[index].ordw_waybillid, orderwaybill_callback , 'GET', 'TEXT', false, true );		  Ajax.call( 'member_order.php?act=getdeliveryinfo', 'ordw_consigid=' + obj[index].ordw_consigid, orderconsig_callback , 'GET', 'TEXT', false, true );		  /*		  order_text += "<div class='delivery_item'>包裹#"+(index+1)+		  "&nbsp;（"+obj[index].ordw_orderno+"）&nbsp;申报价值："+roundNumber(obj[index].ordw_applyprice,2) + "&nbsp;<span id='applyprice_"+(index+1)+"'>"+obj[index].Name	         +"</span>&nbsp;&nbsp;包裹重量："+roundNumber(obj[index].ordw_goodweight,2) +	         " (<span id='goodweight_"+(index+1)+"'>"+obj[index].WeightUnit+	        		 "</span>) &nbsp;发货单号："+ waybillno			 +"<ul class='item_list'>"+goods_text+"</ul>"			 +"<span style='font-weight:bold;color:red;'>收货信息："+consigee_text+"</span><br>"			 +"包裹运费：<span>"+roundNumber(obj[index].ordw_waybillcost,2)+			 "</span><span id='waybillcost_"+(index+1)+"'>"+obj[index].Name+			 "</span>， 关税：<span>"+roundNumber(obj[index].ordw_tariff,2)+			 "</span><span id='tariff_"+(index+1)+"'>"+obj[index].Name+			 "</span> 保险费用：<span>"+roundNumber(obj[index].ordw_insurprice,2)+			 "</span><span id='insurprice_"+(index+1)+"'>"+obj[index].Name+"</span>"			 +"</div>";			*/		 obj[index].Name = " 元";		  order_text+="<tr>";		  order_text+="<td>包裹#"+(index+1)+obj[index].ordw_orderno+"</td>";		  order_text+="<td>"+roundNumber(obj[index].ordw_applyprice,2)+"</td>";		  order_text+="<td>"+roundNumber(obj[index].ordw_goodweight,2) +		         " (<span id='goodweight_"+(index+1)+"'>g"+        		 "</span>)</td>";		  order_text+="<td>"+waybillno+"</td>";		  order_text+="<td>"+goods_text+"</td>";		  order_text+="<td><span style='font-weight:bold;color:red;'>"+consigee_text+"</span></td>";		  order_text+="<td><span>"+roundNumber(obj[index].ordw_waybillcost,2)+			 "</span><span id='waybillcost_"+(index+1)+"'>"+obj[index].Name+			 "</span></td>";		  order_text+="<td><span>"+roundNumber(obj[index].ordw_tariff,2)+			 "</span><span id='tariff_"+(index+1)+"'>"+obj[index].Name+			 "</span></td>";		  order_text+="<td><span>"+roundNumber(obj[index].ordw_insurprice,2)+"</span><span id='insurprice_"+(index+1)+"'>"+obj[index].Name+"</span></td>";		  order_text+="</tr>";	   }	   delivery.innerHTML = order_text;	}    //获得订单中运单信息	function orderwaybill_callback(result)	{		goods_text = '<ul>';	    var obj = eval('(' + result + ')');		for(var index = 0;index < obj.length;index++)		{			goods_text += obj[index].ordg_goodname;			//"<li>物品"+(index+1)+":"+obj[index].ordg_goodname+"&nbsp;&nbsp;申报价值："+roundNumber(obj[index].ordg_goodprice,2)+" X 数量："+obj[index].ordg_goodnumber+" = 总价："+roundNumber(parseFloat(obj[index].ordg_goodprice)*obj[index].ordg_goodnumber,2)+"</li>";		}		goods_text+="</ul>";	}    //获得收货人的详细信息    var consigee_text;    function orderconsig_callback(result)	{		consigee_text = '';	    var obj = eval('(' + result + ')');	    var data = obj[0];	    var name=obj[0].Name;	    if(name == null)    	{	    	name='';    	}	    var address = obj[0].da_address;	    if(address == null)    	{	    	address='';    	}	    var zipcode="（"+obj[0].da_zipcode+"）";	    if(zipcode == null || zipcode=='（）')    	{	    	zipcode='';    	}	    consigee_text = obj[0].da_consignee + 	    "（"+obj[0].da_consigneetelephone+" "+	    obj[0].da_sparetelephone+"）<br>地址："+data.country_name + "  "+name+address+zipcode;	}	//将数字金额进行千位分隔	 function formatNumber(number) 	 {	    number = number.replace(/,/g, "");	    var digit = number.indexOf(".");	    // 取得小数点的位置	    var int = number.substr(0,digit); 	    // 取得小数中的整数部分	    var i;	    var mag = new Array();	    var word;	    if(number.indexOf(".") == -1) 	    { 	       // 整数时	       i = number.length; 	       // 整数的个数	       while(i > 0) 	       {	          word = number.substring(i, i - 3); 	          // 每隔3位截取一组数字	          i -= 3;	          mag.unshift(word);	          // 分别将截取的数字压入数组	        }	        number = mag;	     }	     else 	     { 	        // 小数时	        i = int.length; 	        // 除小数外，整数部分的个数	        while(i > 0) 	        {	           word = int.substring(i, i - 3); 	           //每隔3位截取一组数字	           i -= 3;	           mag.unshift(word);	         }	         number = mag + number.substring(digit);	     }	     return number;	 }	 	/**	 * 保留两位小数	 * @param {Object} number	 * @param {Object} decimals	 */	function roundNumber(number,decimals) {	var newString;// The new rounded number	decimals = Number(decimals);	if (decimals < 1) {		newString = (Math.round(number)).toString();	} else {		var numString = number.toString();		if (numString.lastIndexOf(".") == -1) {// If there is no decimal point			numString += ".";// give it one at the end		}		var cutoff = numString.lastIndexOf(".") + decimals;// The point at which to truncate the number		var d1 = Number(numString.substring(cutoff,cutoff+1));// The value of the last decimal place that we'll end up with		var d2 = Number(numString.substring(cutoff+1,cutoff+2));// The next decimal, after the last one we want		if (d2 >= 5) {// Do we need to round up at all? If not, the string will just be truncated			if (d1 == 9 && cutoff > 0) {// If the last digit is 9, find a new cutoff point				while (cutoff > 0 && (d1 == 9 || isNaN(d1))) {					if (d1 != ".") {						cutoff -= 1;						d1 = Number(numString.substring(cutoff,cutoff+1));					} else {						cutoff -= 1;					}				}			}			d1 += 1;		} 		if (d1 == 10) {			numString = numString.substring(0, numString.lastIndexOf("."));			var roundedNum = Number(numString) + 1;			newString = roundedNum.toString() + '.';		} else {			newString = numString.substring(0,cutoff) + d1.toString();		}	}	if (newString.lastIndexOf(".") == -1) {// Do this again, to the new string		newString += ".";	}	var decs = (newString.substring(newString.lastIndexOf(".")+1)).length;	for(var i=0;i<decimals-decs;i++) newString += "0";	//var newNumber = Number(newString);// make it a number if you like	return newString; // Output the result to the form field (change for your purposes)}{/literal}</script><!--footer-->{include file="footer.htm"}<!--/footer--></body></html>