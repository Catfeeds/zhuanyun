
 {include file="header_user.htm"}


   <!--conter-->
    <div class="conter">
	 <div class="member">
	   {include file="member_menu.htm"} 
	   <div class="conter_right">
	   	
		  <div class="member_sub">
		  	<div class="cr_bot">
	    	  	 	<h2>货到即发<span><a href="toPackageForecastInstruction">查看包裹预报使用说明。</a></span></h2>
	    	  	 </div>


		   <form enctype="multipart/form-data" action="member_packagemanage.php?act=member_insert" method="post" name="theForm" onsubmit="return validate()">
   			<div class="div_step_des">
   				<span class="span_step">主要信息</span>
   			</div>
		       <table class="datum tb  member_stock packageTb">
		     	<tr>
		     		<td class="tb_left">请选择仓库：</td>
		     		<td>
	     				<select name="pck_warehouseid" onchange="select_warehouse(this.options[this.options.selectedIndex].value)">
			 			<option value='0'>{$lang.select_warehouse}</option>{$warehouse_list}
		 			</select>
		 			<span class="span_des">已选定默认仓库，如无其它需求，请勿选择其它仓库！</span>
		 			<span id="housewarn" class="span_control"></span>
			 	</td>
		     	</tr>
		     	<tr>
		     		<td></td>
		     		<td>
		     			<div style="padding:5px 0px 0px 0px; COLOR: #009" id="houseinfo">
		     			仓库地址：{$warehouse_currecy.Province} {$warehouse_currecy.City} {$warehouse_currecy.AreaName} {$warehouse_currecy.Address}
			 		</div>
		     		</td>
		     	</tr>
		     	<tr>
		     		<td class="tb_left">{$lang.pck_expressnumber}：</td>
		     		<td>
		     			<input name="pck_expressnumber" class="member_text" type="text" onblur="pck_expressnumber_validate(this.value)"/>
		     			<span class="span_required">*</span> 
		     			<span class="span_required" id="pck_expressnumber_des"></span>
		     		</td>
		     	</tr>
		     <!-- 	<tr>
		     		<td class="tb_left">邮件正文：</td>
		     		<td>
			 			<input name="pck_expressnumber_content" class="member_text" type="text" />
			 			<span class="span_des">可直接复制邮件正文，系统将默认识别包裹单号！</span>
		     		</td>
		     	</tr> -->
		     	<tr>
		     		<td class="tb_lefts" style="vertical-align: top;"><p>详细商品信息：</p></td>
		     		<td>
			 		<table class="package" id="testTab">
							<tr>
								<th>序号</th>
								<th style="width:20%;">商品类别</th>
								<th>商品名称</th>
								<th>数量</th>
								<th id="unitprice">单价（{$warehouse_currecy.Name}）</th>
								<th id="totalprice">总价（{$warehouse_currecy.Name}）</th>
								<th><input class="buts"  type="button" name="tianjia" onClick="addTr()" /></th>
							</tr>
							<tr>
								<td class="member_package0">1</td>
								<td class="dengjs">
							  		<select id="tab1_ratename1" style='width:98%;height:100%;' name="tab1_ratename1" onchange="select_ratetax_name(this.options[this.options.selectedIndex].value,1)">
					  					<option value="0">请选择</option>
									        <option value="1" selected="true">个人物品</option>
					  				</select>
								</td>
								<td class="member_package1"><input name="pckg_name0" style='height:23px;width:96%' type="text" /></td>
								<td class="member_package2"><input name="pckg_amount0" style='height:23px;width:96%' value="" onblur="upperCase(1)" type="text" /></td>
								<td class="member_package3"><input name="pckg_unitprice0" style='height:23px;width:96%' value="" onblur="upperCase(1)" type="text" /></td>
								<td class="member_package4"><input name="pckg_totalprice0" style='height:23px;width:96%' type="text" size="6" readonly="true" /></td>
								<td class="member_package5"></td>
							</tr>
							
							<tr>
					  			<td colspan="7" style="text-align:left;padding-left:15px;">
					  				申报价值：<input type="text" id="tb1_applyprice" name="tb1_applyprice" readonly="true" size="4" value="0.00"></input>
					  				&nbsp;<input type="hidden" id="tb1_hidtariff" name="tb1_hidtariff" value="0.00" />
					  				<input type="hidden" name="tb1_hidgoodscount" id="tb1_hidgoodscount" value="1" ></input>
					  				<input type="hidden" name="tb1_hidinsurancecost" id="tb1_hidinsurancecost" value="0.00" ></input>
					  				<input style="margin-top:2px; vertical-align:middle;" name="tb1_insurance" id="tb1_insurance" onclick="ApplyPrice_Click(1);" type="checkbox" value="1" />
					  				需要购买保险（<a id="tb1_insurancecost">0.00</a>）
					  			</td>
					  		</tr>
					 </table>
		     		</td>
		     	</tr>
		     	<tr>
		     		<td class="tb_lefts"><p>备注说明：</p></td>
				<td><textarea name="pck_userremark"></textarea></td>
		     	</tr>
		     	<tr>
		     		<td align="right" valign="top">升级包装：</td>
		     		<td>
					需要加固的散件个数：
					<select style="width:70px;" onchange="SelectUpgradePackage();" id="UpgradePackage" name="UpgradePackage">
						<option value=0>请选择</option>
						<option value=1>1</option>
						<option value=2>2</option>
						<option value=3>3</option>
						<option value=4>4</option>
						<option value=5>5</option>
						<option value=6>6</option>
						<option value=7>7</option>
						<option value=8>8</option>
						<option value=9>9</option>
						<option value=10>10</option>
						<option value=11>11</option>
						<option value=12>12</option>
						<option value=13>13</option>
						<option value=14>14</option>
						<option value=15>15</option>
						<option value=16>16</option>
						<option value=17>17</option>
						<option value=18>18</option>
						<option value=19>19</option>
						<option value=20>20</option>
					</select>
					  <p id="upgradepackage"  style="float:right; margin-right:345px; ">单独的包装JPY100日元/个（5.48人民币/个）</p>
		                   </td>
	                   </tr>
					
			<tr>
	                            <td></td>
	                            <td>
	    			         <input style="margin-top:2px; vertical-align:middle;" id="oustsidebrane" name="oustsidebrane" onclick="OustSide_Click();" type="checkbox" value="1" />
		    			<label for="oustsidebrane">外箱缠绕膜</label>
                      			<p id="outsidecost" style="float:right; margin-right:545px; display:none;"></p>
	                            </td>
			 </tr>
		     </table>
   			<div class="div_step_des">
   				<span class="span_step">
					<label for="chk_show" style="position:relative;top:-3px;">附属信息</label>
					<input id="chk_show" type="checkbox" style="position:relative;top:-1px;" onclick="show_other_mess()"/>
				</span>
   			</div>
		     <div id="other_mess" class="hide">
			    <table class="datum tb  member_stock packageTb">
			     	<tr>
			     		<td class="tb_left">线路快递：</td>
			     		<td>
						 <select name="pck_expressid">
						 	<option>{$lang.select_dictionary}</option>
						 	{$package_shipment_option}
						 </select>
			 		</td>
			     	</tr>
			     	
			     	<tr>
			     		<td class="tb_left">
			     			预计重量：
						</td>
						<td>
							<input name="pck_weight" class="member_text" type="text" />
							<span id="WeightUnit">{$warehouse_currecy.WeightUnit}</span>
						</td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">订单号：</td>
			     		<td>
			     			<select name="pck_ordersite">
				 			<option>{$lang.select_ordersite}</option>
				 			<option value=0>线下购买</option>
					 		{$package_shopping_site_option}
				 		</select> - 
				 		<input name="pck_ordernumber" class="member_text" type="text" placeholder="填写订单号" />
				 	</td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">尺寸：</td>
			     		<td>
			     			<input name="pck_sizelength" class="member_text tiny-text" placeholder="长"  type="number" /> x 
			 				<input name="pck_sizewidth" class="member_text tiny-text" placeholder="宽"  type="number" /> x 
			 				<input name="pck_sizeheight" class="member_text tiny-text" placeholder="高"  type="number" />
			     		</td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">凭证1：</td>
			     		<td><input type="file" name="shoppingvouchers1"/></td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">凭证2：</td>
			     		<td><input type="file" name="shoppingvouchers2"/></td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">凭证3：</td>
			     		<td><input type="file" name="shoppingvouchers3"/></td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">凭证4：</td>
			     		<td><input type="file" name="shoppingvouchers4"/></td>
			     	</tr>
			     	<tr>
			     		<td class="tb_left">凭证5：</td>
			     		<td><input type="file" name="shoppingvouchers5"/></td>
			     	</tr>
				 </table>
			 </div>
			 <input type="hidden" name="pck_assess" value="0" id="pck_assess"></input>
			 <button type="submit">提交订单</button>
			 <input type="hidden" name="pckgcount" value="1" id="pckg"></input>
			 <input type="hidden" name="pck_name" value="" id="pck_name"></input>
			 <input type="hidden" id="hidden_pck_expressnumber" value="0"></input>
			 </form>
		  </div>
	   </div>
	   <div class="clear"></div>
	 </div>
	</div>
  <!--footer-->
  {include file="footer_user.htm"}
  <!--/footer-->
  {literal}
<script type="text/javascript">
//添加一个详细商品信息行
//要确定行的唯一性（提示：你可以使用你的主键）
   var id=2;
	//添加行的方法
   function addTr()
   { 
    //获得表格对象
    var tb=document.getElementById('testTab');
   
    //添加一行    
    var newTr = tb.insertRow(-1);//在最下的位置
   
    //给这个行设置id属性，以便于管理（删除）
    newTr.id='tr'+id;
    //设置对齐方式（只是告诉你，可以以这种方式来设置任何它有的属性）
    newTr.align='center';
    //添加6列    
    var newTd0 = newTr.insertCell(0);    
    var newTd1 = newTr.insertCell(1);
	var newTd2 = newTr.insertCell(2);
	var newTd3 = newTr.insertCell(3);    
    var newTd4 = newTr.insertCell(4);
	var newTd5 = newTr.insertCell(5);
    var newTd6 = newTr.insertCell(6);
    //设置列内容和属性    
	
    newTd0.innerHTML=id; //让你看到删除的是指定的行
	newTd1.innerHTML= "<td class='dengjs'><select id='tab1_ratename"+(id-1)+"' style='width:98%;height:100%;' name='tab1_ratename1'onchange='select_ratetax_name(this.options[this.options.selectedIndex].value,1)'><option value='0'>请选择</option><option value='1' selected='true'>个人物品</option></select></td>";
	newTd2.innerHTML= "<input name='pckg_name"+(id-1)+"' style='height:23px;width:96%' type='text' size='21' />";
	newTd3.innerHTML= "<input name='pckg_amount"+(id-1)+"' style='height:23px;width:96%' onblur='upperCase("+id+")' type='text' size='4' />";
	newTd4.innerHTML= "<input name='pckg_unitprice"+(id-1)+"' style='height:23px;width:96%' onblur='upperCase("+id+")' type='text' size='7' />";
	newTd5.innerHTML= "<input name='pckg_totalprice"+(id-1)+"' style='height:23px;width:96%' type='text' size='6' readonly='true'/>";
    newTd6.innerHTML= "<img src='themes/default/images/submit2.png' style='width:19px; height:20px;' class='dengj6' onclick=\"moveTr('"+id+"');\"/>";

    document.getElementById("pckg").value=(id);
    id++;
   }
   //移除行的方法
   function moveTr(id)
   {
    //获得表格对象
    var tb=document.getElementById('testTab');
    //根据id获得将要删除行的对象
    var tr=document.getElementById('tr'+id);
    //取出行的索引，设置删除行的索引
    tb.deleteRow(tr.rowIndex);
   
   }
   
   function upperCase(index)
   {
	    index = index-1;
	   
		var name_pckg_amount='pckg_amount'+index;
		var name_pckg_unitprice='pckg_unitprice'+index;
	    var name_pckg_totalprice='pckg_totalprice'+index;
	    	
		var pckg_amount = document.getElementsByName(name_pckg_amount);
		var pckg_unitprice = document.getElementsByName(name_pckg_unitprice);
		var pckg_totalprice = document.getElementsByName(name_pckg_totalprice);
		
		var pckg_amount_value = 0;
		var pckg_unitprice_value = 0;
		for (var i = 0; i < pckg_amount.length; i++) {
			pckg_amount_value = pckg_amount[i].value;
		}
		for (var i = 0; i < pckg_unitprice.length; i++) {
			pckg_unitprice_value = pckg_unitprice[i].value;
		}
		if(Utils.trim(pckg_amount_value)!='' && !Utils.isNumber(pckg_amount_value))
		{
			for (var i = 0; i < pckg_amount.length; i++) {
				pckg_amount[i].value = '1';
			}
			pckg_amount_value = 1;
			alert(pckg_amount_value+'数据格式错误');
		}
		if(Utils.trim(pckg_unitprice_value)!='' && !Utils.isNumber(pckg_unitprice_value))
		{
			for (var i = 0; i < pckg_unitprice.length; i++) {
				pckg_unitprice[i].value = '1';
			}
			pckg_unitprice_value = 1;
			alert(pckg_unitprice_value+'数据格式错误');
		}
		
		if(pckg_amount_value!=0 && pckg_unitprice_value!=0)
		{
			for (var i = 0; i < pckg_totalprice.length; i++) {
				pckg_totalprice[i].value = parseInt(pckg_amount_value) * parseInt(pckg_unitprice_value);
			}
		}
		else
		{
			for (var i = 0; i < pckg_totalprice.length; i++) {
				pckg_totalprice[i].value = "";
			}
		}
   }
   
   //显示附属信息
   function show_other_mess()
   {
       var bischecked = $('#chk_show').is(':checked');
	   if(bischecked)
	   {
		   $('#other_mess').removeClass("hide");
	   }
	   else{
		   $('#other_mess').addClass("hide");
	   }
   }
   
   function pck_expressnumber_validate(value)
   {
	   $.ajax({
			type: 'POST',
			url: 'member_forecast.php?act=expressnumber_validate',
			data: {'pck_expressnumber':value},
			dataType:'json',
			success:function(json){
				if(json.error!=0)
				{
					$('#pck_expressnumber_des').text(pck_expressnumber_isexist);
					$('#hidden_pck_expressnumber').val("1");
				}else{
					$('#pck_expressnumber_des').text('');
					$('#hidden_pck_expressnumber').val("0");
				}
			},
			error:function(){
				alert(loading_error);
			}
		});
   }

   function validate()
   {
	   validator = new Validator("theForm");
	   validator.selectRequired("pck_warehouseid",  notnull_pck_warehouseid);
	   validator.required("pck_expressnumber", notnull_pck_expressnumber);

		if($('#hidden_pck_expressnumber').val() == "1")
		{
			validator.addErrorMsg(pck_expressnumber_isexist);
			$('#pck_expressnumber_des').text(pck_expressnumber_isexist);
		}
       if(!validator.passed())
   	   {
   	   		return false;
   	   }
	   //$_LANG['js_languages']['notnull_pckg_amount'] = '数量不能为空！';
	   //$_LANG['js_languages']['notnull_pckg_unitprice'] = '单价不能为空！';
	   
	   /*
	   //获取table所有行
	   var table = document.getElementById('testTab');
	   var rows = table.rows.length;
	   var value=0;
	   var pck_name = '';
	   for(var i=1;i<rows;i++)
	   {
	   		//获取第一列的值
	   		var colIndex = parseInt(table.rows[i].cells[0].innerHTML);
	   		var pckg_name = document.getElementsByName('pckg_name'+(colIndex-1));
			var pckg_totalprice = document.getElementsByName('pckg_totalprice'+(colIndex-1));
			for (var j = 0; j < pckg_totalprice.length; j++) {
				if(pckg_totalprice[j].value=='')
				{
					alert('总价不能为空');
				 	return false;
				}
				value = value +parseInt(pckg_totalprice[j].value);
			}
			
			for (var j = 0; j < pckg_name.length; j++) {
				pck_name = pck_name+pckg_name[j].value+' ';
				if(pckg_name[j].value=='')
				{
					alert(notnull_pckg_name);
				 	return false;
				}
			}
			
	   }*/
	   /*
	   pck_name=pck_name.substring(0,pck_name.length-1);

	   //设置总价格
	   document.getElementById('pck_assess').value = value;
	   document.getElementById('pck_name').value = pck_name;
	   */
	   return true;
   }
</script>
  {/literal}
  <script type="text/javascript" src="themes/default/js/logisticssystem/member_forecast.js"></script>
 </body>
 </html>